<% @ports.each do |port| %>
NameVirtualHost *:<%=port%>
<% end %>

<% @projects.each do |project| %>
<% if project['port'].has_key?('secure') %>

<% else %>

<VirtualHost *:<%=project['port']['insecure']%>>
  ServerName <%=project['host']%>
  DocumentRoot /home/<%=@user_name%>/<%=project['directory']%>

  <Directory "/home/<%=@user_name%>/<%=project['directory']%>">
    Order allow,deny
    Allow from all
  </Directory>
</VirtualHost>

<VirtualHost *:<%=project['port']['insecure']%>>
  ServerName www.<%=project['host']%>

  RewriteEngine on
  RewriteRule ^(.*)$ <%=project['host']%>%{REQUEST_URI} [R=301,L]
</VirtualHost>
<% end %>
<% end %>
